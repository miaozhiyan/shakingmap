<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hello, World</title>
    <style type="text/css">
        html{height:100%}
        body{height:100%;margin:0px;padding:0px}
        #container{height:100%}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&amp;ak=8Lrjtbq9AVIkXQGyI495DhPV1TfuKNtY">
    </script>
</head>

<body>
<input id="searchText" type="text" name="searchText"></input>
<input type="button" id = "searchButton" name="searchButton" value="查询"/>
<input type="button" id = "currentLocaltion" name="currentLocaltionButton" value="当前位置"/>
<input type="button" id = "interestingSearch" name="interestingSearchButton" value="某个城市特定类型的地点"/>
<input id="cityText" type="text" name="cityText"></input>
<span> ——————————</span>
<input type="button" id = "magicLocation" name="magicLocation" value="显示上传的地点"/>
<div id="container"></div>
<script type="text/javascript">
    var map = new BMap.Map("container");
    // 创建地图实例
    var point = new BMap.Point(111.2888001000,30.7081000101);
    // 创建点坐标
    map.centerAndZoom(point, 18);
    // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
    map.addControl(new BMap.NavigationControl({enableGeolocation:false})); //比例尺控件
    map.addControl(new BMap.ScaleControl({anchor: BMAP_ANCHOR_BOTTOM_LEFT})); //左下角
    map.addControl(new BMap.OverviewMapControl());
    //map.addControl(new BMap.MapTypeControl());
    //map.setCurrentCity("武汉"); // 仅当设置城市信息时，MapTypeControl 的切换功能才能可用


    //获得当前位置方法
    var currentLocaltionButton = document.getElementById("currentLocaltion");
    currentLocaltionButton.onclick = function(){
        map.clearOverlays();
        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == 0){
                var mk = new BMap.Marker(r.point);
                map.addOverlay(mk);
                map.panTo(r.point);
                //alert('您的位置：'+r.point.lng+','+r.point.lat);
            }
            else {
                alert('failed'+this.getStatus());
            }
        },{enableHighAccuracy: true})
    }

    //点击事件获取经纬度
    map.addEventListener("dblclick",function(e){
        prompt("鼠标单击地方的经纬度为：",e.point.lng + "," + e.point.lat);
    });

    //查询方法
    var searchElement = document.getElementById("searchButton");
    searchElement.onclick = function(){
        map.clearOverlays();

        var searchText = document.getElementById("searchText");

        var local = new BMap.LocalSearch(map,{
            renderOptions: {
                map: map,
                autoViewport: true,
                selectFirstResult: false,
                panel: "results"
            },
            pageCapacity: 8
        });
        local.search(searchText.value);
    }


    //兴趣点查找
    var interestSearchElement = document.getElementById("interestingSearch");
    interestSearchElement.onclick = function(){
        map.clearOverlays();

        var searchText = document.getElementById("searchText");
        var searchCity = document.getElementById("cityText");
        var local = new BMap.LocalSearch(searchCity.value,{
            renderOptions:{
                map: map,
                autoViewport: true,
                selectFirstResult: false,
                panel: "results"
            },
            pageCapacity: 16
        });
        local.search(searchText.value);
    }


    var magicPosition = document.getElementById("magicLocation");
    magicPosition.onclick = function () {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.status==200){
                if ( xmlhttp.readyState==4){
                    map.clearOverlays();
                    var resStr = xmlhttp.response;
                    var res = JSON.parse(resStr);
                    var regionList;
                    if(res.code == 0){
                        regionList = res.data;
                    }
                    drawRegion(map,regionList);
                }
            }
        }

        xmlhttp.open("get","/user/showMagicPosition");
        xmlhttp.send(null);
    }


</script>
<script  type='text/javascript' src="/static/drawRegion.js"></script>
</body>
</html>

